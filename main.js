(()=>{"use strict";class t{#t;#e;#s;#i;#r;constructor(t,e){this.#s=0,this.#i=t,this.#t=!1,this.#e=!1,this.#r=e}name(){return this.#r}hit(){if(this.#s===this.#i)throw new Error("ship is already destroyed, cannot hit again");this.#s++,this.#s===this.#i&&(this.#t=!0)}hits(){return this.#s}length(){return this.#i}place(){this.#e=!0}unplace(){this.#e=!1}isPlaced(){return this.#e}isSunk(){return this.#t}string(){return JSON.stringify({name:this.#r,placed:this.#e,hits:this.#s})}}const e=Object.freeze({PHASE_CHANGE:"phaseChange",RECEIVED_ATTACK:"receivedAttack",RECEIVED_ATTACK_HIT:"receivedAttackHit",RECEIVED_ATTACK_MISS:"receivedAttackMiss",ATTACK:"attack",GAME_OVER:"gameOver",SELECT_GAME_TYPE:"selectGameType",GAME_START:"gameStart",TRY_PLACE_SHIP:"tryPlaceShip",PLACE_SHIP_SUCCESS:"placeShipSuccess",PLACE_SHIP_FAIL:"placeShipFail",PLAYER0_READY:"player0Ready",PLAYER1_READY:"player1Ready",UNPLACE_SHIP:"unplaceShip",SHIP_SUNK:"shipSunk"}),s=new class{constructor(){this.events={}}on(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}off(t,e){this.events[t]&&(this.events[t]=this.events[t].filter(t=>t!==e))}offAll(){this.events={}}emit(t,...e){this.events[t]&&this.events[t].forEach(t=>{t(...e)})}};class i{constructor(t,e){this.x=t,this.y=e}equal(t){return this.x===t.x&&this.y===t.y}moveLoc(t,e){return new i(this.x+t,this.y+e)}isOOB(t,e){return this.x<0||this.y<0||this.x>t||this.y>e}copy(){return new i(this.x,this.y)}}const r=Object.freeze({CARRIER:{name:"carrier",size:5},BATTLESHIP:{name:"battleship",size:4},CRUISER:{name:"cruiser",size:3},SUBMARINE:{name:"submarine",size:3},DESTROYER:{name:"destroyer",size:2}}),n=Object.freeze({PLAYER_0:0,PLAYER_1:1,COMPUTER:1}),o=Object.freeze({COMPUTER:0,PLAYER:1});class a{#n;#o;#a;#l;#h;#d;#c;constructor(e){this.#n=10,this.#o=10,this.#h=e,this.#a=new Map;for(const e of Object.values(r))this.#a.set(e.name,new t(e.size,e.name));this.#l=[],this.#d=[];for(let t=0;t<this.#n;t++)this.#l.push(new Array(this.#o)),this.#d.push(new Array(this.#o));this.#c=!0}get carrier(){return this.#a.get("carrier")}get battleship(){return this.#a.get("battleship")}get cruiser(){return this.#a.get("cruiser")}get submarine(){return this.#a.get("submarine")}get destroyer(){return this.#a.get("destroyer")}lock(){this.#c=!0}unlock(){this.#c=!1}isLocked(){return this.#c}height(){return this.#n}width(){return this.#o}ships(){return this.#a}board(){return this.#l.map(t=>t.slice())}hitBoard(){return this.#d.map(t=>t.slice())}#p(t){return t.x<0||t.x>=this.#o||t.y<0||t.y>=this.#n}receiveAttack(t,i){if(s.emit(e.RECEIVED_ATTACK,this.#h),!this.#l[i][t])return void s.emit(e.RECEIVED_ATTACK_MISS,t,i,this.#h);const r=this.#l[i][t],n=r.name();r.hit(),this.allShipsSunk()?s.emit(e.GAME_OVER,t,i,n,this.#h):r.isSunk()?s.emit(e.SHIP_SUNK,t,i,n,this.#h):s.emit(e.RECEIVED_ATTACK_HIT,t,i,n,this.#h)}canAttack(t,e){return void 0===this.#d[e][t]}attack(t,e){if(this.isLocked())throw new Error("cannot attack right now, must wait your turn");if(this.#p(new i(t,e)))throw new Error("attack location is out of bounds");if(void 0!==this.#d[e][t])throw new Error("already attacked this location");this.#d[e][t]=!0}canPlaceShip(t,e,s){return t&&!this.isLocked()&&!t.isPlaced()&&!this.#p(e)&&!this.#p(s)&&this.isEmptyBetween(e,s)&&a.isCorrectShipLength(t,e,s)}static isCorrectShipLength(t,e,s){return(Math.abs(e.x-s.x)||Math.abs(e.y-s.y))+1===t.length()}placeShip(t,e,s){if(!t)throw new Error("is not a valid ship");if(this.isLocked())throw new Error("cannot place ship, must wait your turn");if(t.isPlaced())throw new Error("ship is already placed");if(this.#p(e)||this.#p(s))throw new Error("start or end point is out of bounds of board");if(!a.isCorrectShipLength(t,e,s))throw new Error("implied ship length does not match actual");if(!this.isEmptyBetween(e,s))throw new Error("ships colliding at place ship path");const i=a.cmp(s.x,e.x),r=a.cmp(s.y,e.y);let n=e;for(this.#l[n.y][n.x]=t;!n.equal(s);)n=n.moveLoc(i,r),this.#l[n.y][n.x]=t;t.place()}unplaceShip(t){if(!t)throw new Error("is not a valid ship");for(let e=0;e<this.#l.length;e++)for(let s=0;s<this.#l[0].length;s++)this.#l[e][s]===t&&(this.#l[e][s]=void 0);t.unplace()}static cmp(t,e){return t===e?0:t>e?1:-1}isEmptyBetween(t,e){const s=a.cmp(e.x,t.x),i=a.cmp(e.y,t.y);let r=t;if(void 0!==this.#l[r.y][r.x])return!1;for(;!r.equal(e);)if(r=r.moveLoc(s,i),void 0!==this.#l[r.y][r.x])return!1;return!0}allShipsSunk(){const t=this.ships().values();for(const e of t)if(!e.isSunk())return!1;return!0}}const l=Object.freeze({SETUP:0,ATTACK:1});class h{#y;#u;#m;#g;#b;#S;init(){this.#g=new a(0),this.#b=new a(1),this.#u=n.PLAYER_0,this.#m=l.SETUP,this.#S=[],this.#S.push(this.#g,this.#b),this.#g.unlock(),s.emit(e.GAME_START,this.#y)}playerTurn(){return this.#u}changeTurn(){this.#S[this.#u].lock(),this.#u^=1,this.#S[this.#u].unlock()}setGameType(t){if(void 0!==this.#y)throw new Error("game type already set");this.#y=t,this.init()}unsetGameType(){this.#y=void 0}gameType(){return this.#y}isGameOver(){return this.#g.allShipsSunk()||this.#b.allShipsSunk()}produceWinner(){return this.#g.allShipsSunk()?n.PLAYER_1:this.#b.allShipsSunk()?n.PLAYER_0:void 0}currentPlayerBoard(){return this.#S[this.#u]}enemyPlayerBoard(){return this.#S[1^this.#u]}player0Board(){return this.#g}player1Board(){return this.#b}phase(){return this.#m}nextPhase(){if(this.#m===l.ATTACK)throw new Error("already in attack phase");s.emit(e.PHASE_CHANGE),this.#m=l.ATTACK}tryPlaceShip(t,i,r){const n=this.currentPlayerBoard(),o=n.ships().get(t);if(!o)throw new Error("invalid ship name, does not exist in map");n.canPlaceShip(o,i,r)?(n.placeShip(o,i,r),s.emit(e.PLACE_SHIP_SUCCESS,t,i,r,this.playerTurn())):s.emit(e.PLACE_SHIP_FAIL,t,i,r,this.playerTurn())}unplaceShip(t){const e=this.currentPlayerBoard(),s=e.ships().get(t);if(!s)throw new Error("invalid ship name, does not exist in map");e.unplaceShip(s)}static randomMax9(){return Math.floor(10*Math.random())}static randomLoc(){return new i(h.randomMax9(),h.randomMax9())}static randomDir(){return[{dX:1,dY:0},{dX:-1,dY:0},{dX:0,dY:1},{dX:0,dY:-1}][Math.floor(4*Math.random())]}static randomStartEnd(t){const e=t-1,{dX:s,dY:i}=h.randomDir(),r=h.randomLoc(),n=r.moveLoc(s*e,i*e);return[r,n]}randomPlaceShip(t){const e=t.length();let[s,i]=h.randomStartEnd(e);for(;!this.currentPlayerBoard().canPlaceShip(t,s,i);)[s,i]=h.randomStartEnd(e);this.currentPlayerBoard().placeShip(t,s,i)}computerPlaceShips(){if(this.#y!==o.COMPUTER)return;if(this.#u!==n.PLAYER_1)throw new Error("called computer place ships on player 0 (human) turn");const t=this.player1Board();for(const e of Object.values(r)){const s=t.ships().get(e.name);this.randomPlaceShip(s)}s.emit(e.PLAYER1_READY)}attack(t,e,s){if(t!==this.playerTurn())return;const i=this.currentPlayerBoard(),r=this.enemyPlayerBoard();i.canAttack(s,e)&&(i.attack(s,e),r.receiveAttack(s,e))}computerAttack(){this.gameType()===o.COMPUTER&&this.playerTurn()===n.COMPUTER&&setTimeout(()=>{const t=this.currentPlayerBoard(),e=this.enemyPlayerBoard();let s=h.randomLoc();for(;!t.canAttack(s.x,s.y);)s=h.randomLoc();t.attack(s.x,s.y),e.receiveAttack(s.x,s.y)},300)}bindEvents(){s.on(e.SELECT_GAME_TYPE,this.setGameType.bind(this)),s.on(e.GAME_OVER,this.unsetGameType.bind(this)),s.on(e.TRY_PLACE_SHIP,this.tryPlaceShip.bind(this)),s.on(e.UNPLACE_SHIP,this.unplaceShip.bind(this)),s.on(e.PLAYER0_READY,this.changeTurn.bind(this)),s.on(e.PLAYER0_READY,this.computerPlaceShips.bind(this)),s.on(e.PLAYER1_READY,this.changeTurn.bind(this)),s.on(e.PLAYER1_READY,this.nextPhase.bind(this)),s.on(e.ATTACK,this.attack.bind(this)),s.on(e.RECEIVED_ATTACK,this.changeTurn.bind(this)),s.on(e.RECEIVED_ATTACK,this.computerAttack.bind(this))}}class d extends HTMLElement{constructor(){super(),this.classList.add("game-screen"),this.id="game-screen",this.innerHTML="\n\t\t\t<style>\n\t\t\t  .game-screen {\n\t\t\t\tposition: fixed;\n\t\t\t    height: 100vh;\n\t\t\t    width: 100vw;\n\t\t\t    z-index: 10;\n\t\t\t    pointer-events: none;\n\t\t\t  }\n\t\t\t</style>\n\t\t"}}function c(t){return"number"==typeof t}function p(t,e,s="black",i="black",r="1px solid black",n=0){const o=document.createElement("div");o.classList.add("cylinder-2d"),o.style.position="relative",o.style.transformStyle="preserve-3d",o.style.display="grid",o.style.placeItems="center";const a=c(t)?`${t}px`:t,l=c(e)?`${e}px`:e,h=n/2+"px";o.style.height=a;const d=document.createElement("div"),p=document.createElement("div"),y=document.createElement("div"),u=document.createElement("div");return o.style.width=a,d.style.width=a,d.style.height=a,p.style.width=a,p.style.height=a,y.style.width=a,y.style.height=l,u.style.width=a,u.style.height=l,d.style.borderRadius="9999px",d.style.zIndex="5",p.style.borderRadius="9999px",p.style.zIndex="-5",d.style.backgroundImage=`radial-gradient(circle at center, ${i} ${h}, ${s} ${h})`,p.style.backgroundColor=s,y.style.backgroundColor=s,u.style.backgroundColor=s,d.style.position="absolute",p.style.position="absolute",y.style.position="absolute",u.style.position="absolute",d.style.transform=`translateZ(calc(${l} / 2))`,p.style.transform=`translateZ(calc(${l} / 2 * -1))`,y.style.transform="rotateX(90deg)",u.style.transform="rotateX(90deg) rotateY(90deg)",u.style.filter="brightness(0.8)",y.style.filter="brightness(0.8)",p.style.filter="brightness(0.8)",o.appendChild(d),o.appendChild(p),o.appendChild(y),o.appendChild(u),o}function y(t,e,s,i="transparent",r="1px solid black"){const n=`${t}px`,o=`${e}px`,a=`${s}px`,l=document.createElement("div");l.style.transformStyle="preserve-3d",l.style.height=n,l.style.width=o,l.style.display="grid",l.style.placeItems="center";const h=[];for(let t=0;t<6;t++){const t=document.createElement("div");t.style.backgroundColor=i,t.style.transformStyle="preserve-3d",t.style.border=r,t.style.position="absolute",h.push(t),l.appendChild(t)}const[d,c,p,y,u,m]=h;d.style.height=n,d.style.width=o,c.style.height=n,c.style.width=o,u.style.height=a,u.style.width=o,m.style.height=a,m.style.width=o,p.style.height=n,p.style.width=a,y.style.height=n,y.style.width=a;const g=e/2,b=t/2,S=s/2;return d.classList.add("cube__face","cube__front"),c.classList.add("cube__face","cube__back"),p.classList.add("cube__face","cube__left"),y.classList.add("cube__face","cube__right"),u.classList.add("cube__face","cube__top"),m.classList.add("cube__face","cube__bottom"),d.style.transform=`translateZ(${S}px)`,c.style.transform=`translateZ(calc(-1 * ${S}px))`,u.style.transform=`rotateX(90deg) translateZ(${b}px)`,m.style.transform=`rotateX(90deg) translateZ(calc(-1 * ${b}px))`,y.style.transform=`rotateY(90deg) translateZ(${g}px)`,p.style.transform=`rotateY(90deg) translateZ(calc(-1 * ${g}px))`,l}customElements.define("game-screen",d);class u extends HTMLElement{constructor(t,e,s,i){super();const r=i||10;this.innerHTML=`\n          <style>\n            .tray {\n              position: absolute;\n              transform-style: preserve-3d;\n\t\t\t.middle-row {\n\t\t\t\ttransform-style: preserve-3d;\n\t\t\t\tdisplay: flex;\n\t\t\t}\n\t\t\t.main-container {\n\t\t\t\ttransform-style: preserve-3d;\n\t\t\t}\n\t\t\t.board-grid {\n\t\t\t\ttransform-style: preserve-3d;\n\t\t\t\tdisplay: grid;\n\t\t\t\tplace-items: center;\n\t\t\t\tposition: absolute;\n\t\t\t\theight: 100%;\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t\t.tray-face.front {\n\t\t\t\ttransform-style: preserve-3d;\n\t\t\t\tdisplay: grid;\n\t\t\t\tplace-items: center;\n\t\t\t}\n\t\t\t.tray-face.back {\n\t\t\t\theight: 100%;\n\t\t\t\twidth: 100%;\n\t\t\t\tposition: absolute;\n\t\t\t}\n\t\t\t.ship-cell.drop-zone {\n\t\t\t\tbackground-color: #44a7bd9e;\n\t\t\t\tborder-bottom: 1px solid black;\n\t\t\t\t&::before {\n\t\t\t\t\tcontent: "";\n\t\t\t\t\theight: 100%;\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\ttransform-style: preserve-3d;\n\t\t\t\t\ttransform: rotateX(90deg) translateZ(${t/-2}px) translateY(${t/-2}px);\n\t\t\t\t    background-color: #44a7bd9e;\n\t\t\t\t}\n\t\t\t}\n\t\t\t.tray-container {\n\t\t\t\ttransform-style: preserve-3d;\n\t\t\t\ttransform-origin: top;\n\t\t\t    pointer-events: none;\n\t\t\t\t& * {\n\t\t\t\t\tpointer-events: auto;\n\t\t\t\t}\n\t\t\t}\n          </style>\n\t\t  <div class="tray-container">\n\t\t    <div class="tray-rim top"></div>\n\t\t    <div class="middle-row">\n\t\t      <div class="tray-rim left"></div>\n\t\t      <div class="main-container">\n\t\t  \t  <div class="board-grid"></div>\n\t\t        <div class="tray-face front">\n\t\t  \t    <div class="tray-face back"></div>\n\t\t  \t  </div>\n\t\t      </div>\n\t\t      <div class="tray-rim right"></div>\n\t\t    </div>\n\t\t    <div class="tray-rim bottom"></div>\n           </div>\n        `,this.classList.add("tray"),this.querySelector(".tray-rim.left").replaceWith(y(t*r,t,t,e,"1px solid black")),this.querySelector(".tray-rim.right").replaceWith(y(t*r,t,t,e,"1px solid black")),this.querySelector(".tray-rim.top").replaceWith(y(t,t*(r+2),t,e,"1px solid black")),this.querySelector(".tray-rim.bottom").replaceWith(y(t,t*(r+2),t,e,"1px solid black"));const n=this.querySelector(".tray-face.front");n.style.gridTemplateColumns=`repeat(${r}, ${t}px)`,n.style.gridTemplateRows=`repeat(${r}, ${t}px)`;const o=this.querySelector(".board-grid");o.style.gridTemplateColumns=`repeat(${r}, ${t}px)`,o.style.gridTemplateRows=`repeat(${r}, ${t}px)`,o.style.transform=`translateZ(${t/2}px)`;const a=this.querySelector(".tray-face.back");a.style.transform=`translateZ(${-t/2}px)`,a.style.backgroundColor=s}}customElements.define("board-tray",u);class m extends u{#h;constructor(t,e,s,i,r){super(t,s,i),this.classList.add("hit-board"),this.#h=r;const n=this.querySelector(".tray-face.front");this.querySelector(".board-grid").style.pointerEvents="none";const o="#19a5dd8a";for(let s=0;s<100;s++){const i=document.createElement("div");i.classList.add("hit-cell"),i.style.backgroundColor=o,i.style.height=`${t}px`,i.style.width=`${t}px`,i.style.border="1px solid black",i.style.backgroundImage=`radial-gradient(circle at center, #07124dff ${e/2}px, ${o} ${e/2}px)`,i.style.transformStyle="preserve-3d",i.style.display="grid",i.style.placeItems="center";const r=Math.floor(s/10)+1,a=s%10+1;i.setAttribute("data-row",r),i.setAttribute("data-col",a),n.appendChild(i)}this.cellClick=this.handleCellClick.bind(this)}handleCellClick(t){const i=t.target,r=i.getAttribute("data-row"),n=i.getAttribute("data-col");s.emit(e.ATTACK,this.#h,r-1,n-1)}bindEvents(){const t=this.querySelector(".tray-face.front");Array.from(t.querySelectorAll(".hit-cell")).forEach(t=>{t.addEventListener("click",this.cellClick)})}unbindEvents(){const t=this.querySelector(".tray-face.front");Array.from(t.querySelectorAll(".hit-cell")).forEach(t=>{t.removeEventListener("click",this.cellClick)})}}function g(t,e,s,i,r=!1,n=!1){const o=document.createElement("div");o.classList.add("wall"),o.style.transformStyle="preserve-3d",o.style.position="absolute",o.style.display="flex";const a=document.createElement("div");let l,h;a.classList.add("center");let d=t*s;if(r){l=document.createElement("div");const s=document.createElement("div");l.appendChild(s);let r=t/2;l.style.width=`${r}px`,d-=r,r*=1.414,l.classList.add("left"),l.style.backgroundColor=i,l.style.height=`${e}px`,l.style.transformOrigin="100% 50%",l.style.transform="rotateY(-45deg)",l.style.transformStyle="preserve-3d",s.style.width=`${r}px`,s.style.height=`${t}px`,s.style.position="absolute",s.style.right="0",s.style.top="0",s.style.backgroundColor=i,s.style.borderInline="1px solid black"}if(n){h=document.createElement("div");const s=document.createElement("div");h.appendChild(s),h.classList.add("right"),h.style.backgroundColor=i;let r=t/2;h.style.width=`${r}px`,d-=r,r*=1.414,h.style.transform="rotateY(45deg)",h.style.height=`${e}px`,h.style.transformOrigin="0% 50%",h.style.transformStyle="preserve-3d",s.style.width=`${r}px`,s.style.height=`${t}px`,s.style.position="absolute",s.style.left="0",s.style.top="0",s.style.backgroundColor=i,s.style.borderInline="1px solid black"}return a.style.width=`${d}px`,a.style.height=`${e}px`,a.classList.add("wall-piece"),a.style.backgroundColor=i,a.style.transformStyle="preserve-3d",a.style.borderInline="1px solid black",l&&(l.classList.add("wall-piece"),o.appendChild(l)),o.appendChild(a),h&&(h.classList.add("wall-piece"),o.appendChild(h)),o}function b(t,e,s,i,r,n,o=!1,a=!1,l="bevel",h="bevel"){const d=document.createElement("div"),c=document.createElement("div"),p=document.createElement("style");p.innerHTML="\n      .ship {\n        box-sizing: border-box;\n        display: grid;\n        place-items: center;\n\t    transform-style: preserve-3d;\n        & * {\n          box-sizing: inherit;\n        }\n      }\n      .wall {\n        pointer-events: none;\n      }\n\t  .wall-piece {\n\t    opacity: var(--opacity, 1)\n\t  }\n    ",d.appendChild(p),d.classList.add("ship"),d.style.width=t*i+"px",d.style.height=`${t}px`,c.classList.add("rotation-container"),c.style.transformStyle="preserve-3d",c.style.width=t*i+"px",c.style.height=`${t}px`;const y=g(t,e,i,r,o,a),u=g(t,e,i,r,o,a);c.appendChild(y),c.appendChild(u);const m=function(t,e,s,i,r,n,o=!1,a=!1,l="bevel",h="bevel"){const d=document.createElement("div"),c=t*i+"px";d.style.width=c,d.style.height=`${t}px`,d.style.display="grid",d.style.gridTemplateColumns=`repeat(${i}, 1fr)`,d.style.transformStyle="preserve-3d";const p=s/2+"px";for(let t=0;t<i;t++){const t=document.createElement("div");t.style.background=`radial-gradient(circle at center, ${n} ${p}, ${r} ${p})`,t.style.transformStyle="preserve-3d",d.appendChild(t)}let y="0";o&&(d.style.overflow="hidden",d.style.cornerLeftShape=l,y="9999px");let u="0";return a&&(d.style.overflow="hidden",d.style.cornerRightShape=h,u="9999px"),d.style.borderRadius=`${y} ${u} ${u} ${y}`,d.classList.add("wall-piece"),d.style.border="1px solid black",d}(t,0,s,i,r,n,o,a,l,h);return y.style.position="absolute",y.style.transform=`rotateX(-90deg) translateZ(${t/2}px)`,u.style.transform=`rotateX(90deg) translateZ(${t/2}px)`,u.style.position="absolute",m.style.position="absolute",m.style.transform=`translateZ(${t/2}px)`,c.appendChild(m),d.appendChild(c),d}customElements.define("hit-board",m);class S extends HTMLElement{#c;#E;#f;#v;#w;#C;#A;#P;#x;constructor(t,e,s){super(),this.#c=!1,this.style.transformStyle="preserve-3d",this.style.placeSelf="start",this.style.cursor="pointer",this.#E=t,this.#f=s,this.#x=["center",`${e/2}px ${e/2}px`,"center",`${t*e/2}px ${t*e/2}px`],this.#v=0}getShipName(){return this.#f}renderRotation(){this.querySelector(".rotation-container").style.transform=`rotateZ(${this.#v}deg)`}updateTransformOrigin(){const t=this.querySelector(".rotation-container"),e=Math.round(this.#v/90),s=this.#x[e];t.style.transformOrigin=s}rotateCW(){this.#v+=90,this.#v%=360,this.renderRotation()}rotateCCW(){this.#v-=90,this.#v<0&&(this.#v=360+this.#v),this.renderRotation()}setRotation(t){this.#v=90*Math.floor(t/90),this.renderRotation()}getRotation(){return this.#v}lock(){this.#c=!0,this.style.cursor="default"}isLocked(){return this.#c}getSize(){return this.#E}setLocation(t,e){let s=t.x,i=e.x;s>i&&([s,i]=[i,s]);let r=t.y,n=e.y;r>n&&([r,n]=[n,r]),this.#w=r,this.#C=n,this.#A=s,this.#P=i,this.updateGridArea()}getLocation(){return[new i(this.#A,this.#w),new i(this.#P,this.#C)]}updateGridArea(){this.style.gridArea=`${this.#w+1} / ${this.#A+1} / ${this.#C+2} / ${this.#P+2}`}}class E extends S{constructor(t,e){super(3,t,"submarine"),this.innerHTML=b(t,t,e,3,"gray","black",!0,!0,"round","round").innerHTML}}class f extends S{constructor(t,e){super(5,t,"carrier"),this.innerHTML=b(t,t,e,5,"gray","black").innerHTML}}class v extends S{constructor(t,e){super(4,t,"battleship"),this.innerHTML=b(t,t,e,4,"gray","black",!0,!0).innerHTML}}class w extends S{constructor(t,e){super(3,t,"cruiser"),this.innerHTML=b(t,t,e,3,"gray","black",!1,!0).innerHTML}}class C extends S{constructor(t,e){super(2,t,"destroyer"),this.innerHTML=b(t,t,e,2,"gray","black",!0,!1).innerHTML}}customElements.define("ship-submarine",E),customElements.define("ship-carrier",f),customElements.define("ship-battleship",v),customElements.define("ship-cruiser",w),customElements.define("ship-destroyer",C);class A extends u{#T;#L;#a;#k;#_;#R;#B;#$;#H;#I;#M;#z;#D;#O;#h;#Y;constructor(t,e,s,i,r,n){super(t,s,i,r),this.#B=!1,this.#T=t,this.#L=e,this.#h=n;const o=this.querySelector(".tray-face.front"),a=this.querySelector(".board-grid");this.#_=a,this.#R=document.querySelector(".game-screen"),a.id=`ship-grid${this.#h}`;const l=r||10,h=l*l,d=.7*t,c=.3*t;this.#Y=c;for(let i=0;i<h;i++){const r=document.createElement("div");r.style.transformStyle="preserve-3d",r.style.height="100%",r.style.width="100%",r.style.display="grid",r.classList.add("ship-cell");const n=Math.floor(i/10)+1,l=i%10+1;r.setAttribute("data-row",n),r.setAttribute("data-col",l),r.style.gridArea=`${n} / ${l} / ${n+1} / ${l+1}`;const h=p(d-.2*d,`calc(${t}px - ${c}px)`,s,"black","1px solid black",e);h.style.transformStyle="preserve-3d",a.appendChild(r),o.appendChild(h)}}init(){this.buildShips(),this.bindEvents()}buildShips(){this.#a={carrier:new f(this.#T,this.#L),battleship:new v(this.#T,this.#L),submarine:new E(this.#T,this.#L),cruiser:new w(this.#T,this.#L),destroyer:new C(this.#T,this.#L)},this.#k={carrier:new f(this.#T,this.#L),battleship:new v(this.#T,this.#L),submarine:new E(this.#T,this.#L),cruiser:new w(this.#T,this.#L),destroyer:new C(this.#T,this.#L)};const{carrier:t,battleship:e,submarine:s,cruiser:i,destroyer:r}=this.#a,{carrier:n,battleship:o,submarine:a,cruiser:l,destroyer:h}=this.#k;this.#_.append(e,t,s,i,r),this.#R.append(o,n,a,l,h);for(const[,t]of Object.entries(this.#k))t.width=this.#T*t.getSize(),t.height=this.#T,t.style.position="absolute",t.style.display="none",t.style.pointerEvents="none"}handleMouseDownOnShip(t){if(!this.#B){const i=t.currentTarget,r=this.#k[i.getShipName()];s.emit(e.UNPLACE_SHIP,i.getShipName()),this.#I=Math.round(t.target.offsetLeft/this.#T),[this.#D,this.#O]=i.getLocation(),this.#z=i.getRotation(),i.style.setProperty("--opacity","0.3"),i.style.pointerEvents="none",this.#B=!0,this.#H=r,this.#$=i,this.#H.style.left=t.clientX-this.#H.width/2+"px",this.#H.style.top=t.clientY-this.#H.height/2+"px",r.style.display="block"}}handleMouseUp(){if(this.#B){this.#$.style.setProperty("--opacity","1"),this.#$.style.pointerEvents="all",this.#H.style.display="none",this.#B=!1;const{start:t,end:i}=this.draggedStartEndLoc();s.emit(e.TRY_PLACE_SHIP,this.#$.getShipName(),t.moveLoc(-1,-1),i.moveLoc(-1,-1)),this.#$=null,this.#H=null}}handlePointerMove(t){this.#B&&(this.#H.style.left=t.clientX-this.#H.width/2+"px",this.#H.style.top=t.clientY-this.#H.height/2+"px")}handleCellDrag(t){if(this.#B){const e=t.target.getAttribute("data-col"),s=t.target.getAttribute("data-row");this.#M=new i(Number(e),Number(s)),this.renderDropZone()}}static boundInRange(t,e,s){let i=t;return i=i>s?s:i,i=i<e?e:i,i}draggedDeltas(){const t=this.#H;let e,s;return 0===t.getRotation()?(e=1,s=0):180===t.getRotation()?(e=-1,s=0):90===t.getRotation()?(s=1,e=0):270===t.getRotation()&&(s=-1,e=0),{dX:e,dY:s}}draggedStartEndLoc(){const t=this.#H,e=t.getSize(),{x:s}=this.#M,{y:r}=this.#M;let n=new i(s,r),{dX:o,dY:a}=this.draggedDeltas();const l=t.getSize()-1-this.#I,h=new i(s,r).moveLoc(o*-this.#I,a*-this.#I),d=new i(s,r).moveLoc(o*l,a*l),c=function(t){return t.x>10||t.y>10||t.x<1||t.y<1},p=e-1;if(c(d)){let{x:t,y:e}=d;t=A.boundInRange(t,1,10),e=A.boundInRange(e,1,10);const s=new i(t,e);return{start:new i(o*-p+s.x,a*-p+s.y),end:s}}if(c(h)){let{x:t,y:e}=h;t=A.boundInRange(t,1,10),e=A.boundInRange(e,1,10);const s=new i(t,e);return{start:s,end:new i(o*p+s.x,a*p+s.y)}}for(this.addDropZoneClass(n);!n.equal(d);)n=n.moveLoc(o,a),this.addDropZoneClass(n);const y=n.copy();o=-o,a=-a;for(let e=0;e<t.getSize()-1;e++)n=n.moveLoc(o,a),this.addDropZoneClass(n);return{start:n.copy(),end:y}}restoreShips(t){this.#$.style.setProperty("--opacity","1"),this.#$.style.pointerEvents="all",this.#$.setRotation(this.#z),this.#H.setRotation(this.#z),s.emit(e.TRY_PLACE_SHIP,t,this.#D,this.#O)}resetDropZone(){Array.from(this.#_.querySelectorAll(".ship-cell")).forEach(t=>{t.classList.remove("drop-zone")})}renderDropZone(){this.resetDropZone();const{start:t,end:e}=this.draggedStartEndLoc();let s=t;const{dX:i,dY:r}=this.draggedDeltas();for(this.addDropZoneClass(s);!s.equal(e);)s=s.moveLoc(i,r),this.addDropZoneClass(s)}addDropZoneClass(t){const{x:e}=t,{y:s}=t;if(e<1||s<1||e>10||s>10)return;const i=function(t,e){return 10*(e-1)+t}(e,s);this.#_.querySelector(`.ship-cell:nth-child(${i})`).classList.add("drop-zone")}ships(){const t=[];for(const e of Object.values(this.#a))t.push(e);return t}updateShipLocation(t,e,s,i){if(i!==this.#h)return;this.resetDropZone();const r=this.#a[t];if(!r)throw new Error("no ship by name ship:",t);r.setRotation(this.#k[t].getRotation()),r.setLocation(e,s),r.updateTransformOrigin()}handleRKeyPress(){this.#H.rotateCW()}handleQKeyPress(){this.#H.rotateCCW()}handleDraggedKeyPress(t){this.#B&&("r"===t.key?this.handleRKeyPress():"q"===t.key&&this.handleQKeyPress(),this.renderDropZone())}teardown(){for(const t of Object.values(this.#k))this.#R.removeChild(t);for(const t of Object.values(this.#a))t.removeEventListener("mousedown",this.boundHandleMouseDownOnShip);document.removeEventListener("mouseup",this.boundHandleMouseUp),document.removeEventListener("pointermove",this.boundPointerMove),document.removeEventListener("keypress",this.boundHandleKeyPress),Array.from(this.#_.querySelectorAll(".ship-cell")).forEach(t=>t.removeEventListener("mouseenter",this.handleCellDrag))}bindEvents(){s.on(e.PLACE_SHIP_SUCCESS,this.updateShipLocation.bind(this)),s.on(e.PLACE_SHIP_FAIL,this.restoreShips.bind(this)),console.log(this),s.emit(e.TRY_PLACE_SHIP,"carrier",new i(0,0),new i(4,0)),s.emit(e.TRY_PLACE_SHIP,"battleship",new i(0,1),new i(3,1)),s.emit(e.TRY_PLACE_SHIP,"submarine",new i(0,2),new i(2,2)),s.emit(e.TRY_PLACE_SHIP,"cruiser",new i(0,3),new i(2,3)),s.emit(e.TRY_PLACE_SHIP,"destroyer",new i(0,4),new i(1,4)),this.boundHandleMouseDownOnShip=this.handleMouseDownOnShip.bind(this);for(const t of Object.values(this.#a))t.addEventListener("mousedown",this.boundHandleMouseDownOnShip);this.boundHandleMouseUp=this.handleMouseUp.bind(this),document.addEventListener("mouseup",this.boundHandleMouseUp),this.boundPointerMove=this.handlePointerMove.bind(this),document.addEventListener("pointermove",this.boundPointerMove),this.boundHandleKeyPress=this.handleDraggedKeyPress.bind(this),document.addEventListener("keypress",this.boundHandleKeyPress),Array.from(this.#_.querySelectorAll(".ship-cell")).forEach(t=>t.addEventListener("mouseenter",this.handleCellDrag.bind(this)))}getOffsetDepth(){return this.#Y}}customElements.define("ship-board",A);class P extends HTMLElement{#Z;#q;#G;constructor(t,e,s,i,r=!1,n=!1,o=!1,a=!1,l=!1){super();const h=this.attachShadow({mode:"open"}),d=document.createElement("div");d.innerHTML='\n<template name="cylinder-3d" id="cylinder-3d-template">\n  <style>\n    :host {\n      display: block;\n      background-color: inherit;\n      transform-style: preserve-3d;\n      height: 100%;\n      width: 100%;\n    }\n\n    .cylinder__container {\n      height: 100%;\n      width: 100%;\n      box-sizing: border-box;\n      background-color: inherit;\n      display: flex;\n      justify-content: center;\n      transform-style: preserve-3d;\n    }\n\n    .cylinder__container * {\n      box-sizing: inherit;\n    }\n  </style>\n\n  <div class="cylinder__container"><slot></slot></div>\n</template>\n';const c=document.importNode(d.querySelector("#cylinder-3d-template").content,!0),p=c.querySelector(".cylinder__container");this.#Z=p,this.#q=i,this.#G=s,this.render(t,e,r,n,o,a,l),h.appendChild(c)}render(t,e,s,i,r,n,o){const a=t/2,l=function(t,e){const s=Math.PI/180*180;return Math.round(2*e*Math.tan(s/t))}(this.#G,a)+1,h=360/this.#G;let d="none";(s||this.hasAttribute("border"))&&(d=s||this.getAttribute("border")||"1px solid black");for(let t=0,s=0;t<this.#G;t++,s+=h){const t=document.createElement("div");t.classList.add("cylinder__side"),t.style.width=`${l}px`,t.style.height=`${e}px`,t.style.position="absolute",t.style.backgroundColor=this.#q,t.style.transform=`rotateY(${s}deg) translateZ(${a}px)`,t.style.borderRight=d,this.#Z.appendChild(t)}if(this.hasAttribute("inner-thickness")){const t=a-a*Number(this.getAttribute("inner-thickness")),s=a-t;for(let s=0,i=0;s<this.#G;s++,i+=h){const s=document.createElement("div");if(s.style.width=`${l}px`,s.style.height=`${e}px`,s.style.position="absolute",s.style.backgroundColor=this.#q,s.style.transform=`rotateY(${i}deg) translateZ(${t}px)`,this.hasAttribute("shadow-inner")){const t=Number(this.getAttribute("shadow-inner"));s.style.filter=t?`brightness(${t})`:"brightness(0.7)"}s.style.borderTop=d,s.style.borderBottom=d,this.#Z.appendChild(s)}for(let i=0,a=0;i<this.#G;i++,a+=h){const i=document.createElement("div");if(i.style.width=`${l}px`,i.style.height=`${s}px`,i.style.position="absolute",i.style.backgroundColor=this.#q,i.style.transformOrigin="50% 0%",i.style.transform=`rotateX(90deg) rotateZ(${a}deg) translateY(${t}px)`,i.style.borderBottom=d,o||n||this.hasAttribute("shadow-both-caps")||this.hasAttribute("shadow-top-cap")){const t=o||n||this.getAttribute("shadow-both-caps")||this.getAttribute("shadow-top-cap")||.7;i.style.filter=`brightness(${t})`}this.#Z.appendChild(i);const h=document.createElement("div");if(h.style.width=`${l}px`,h.style.height=`${s}px`,h.style.position="absolute",h.style.backgroundColor=this.#q,h.style.transformOrigin="50% 0%",h.style.transform=`rotateX(90deg) rotateZ(${a}deg) translateY(${t}px) translateZ(${-e}px)`,h.style.borderBottom=d,o||r||this.hasAttribute("shadow-both-caps")||this.hasAttribute("shadow-bottom-cap")){const t=o||r||this.getAttribute("shadow-both-caps")||this.getAttribute("shadow-bottom-cap")||.7;h.style.filter=`brightness(${t})`}this.#Z.appendChild(h)}}if(i||this.hasAttribute("cap"))for(let t=0,s=0;t<this.#G;t++,s+=h){const t=document.createElement("div");if(t.style.width=`${l}px`,t.style.top="0",t.style.height=`${a}px`,t.style.position="absolute",t.style.backgroundColor=this.#q,t.style.transformOrigin="50% 0%",t.style.transform=`rotateX(90deg) rotateZ(${s}deg)`,t.style.borderBottom=d,o||n||this.hasAttribute("shadow-both-caps")||this.hasAttribute("shadow-top-cap")){const e=o||n||this.getAttribute("shadow-both-caps")||this.getAttribute("shadow-top-cap")||.7;t.style.filter=`brightness(${e})`}this.#Z.appendChild(t);const i=document.createElement("div");if(i.style.width=`${l}px`,i.style.height=`${a}px`,i.style.position="absolute",i.style.backgroundColor=this.#q,i.style.transformOrigin="50% 0%",i.style.transform=`translateY(${e}px) rotateX(90deg) rotateZ(${s}deg)`,i.style.borderBottom=d,o||r||this.hasAttribute("shadow-both-caps")||this.hasAttribute("shadow-bottom-cap")){const t=o||r||this.getAttribute("shadow-both-caps")||this.getAttribute("shadow-bottom-cap")||.7;i.style.filter=`brightness(${t})`}this.#Z.appendChild(i)}}rebuild(t,e){this.removeCylinderSides(),this.render(t,e)}rebuildWithoutDimensions(){const t=this.offsetWidth,e=this.offsetHeight;this.removeCylinderSides(),this.render(t,e)}removeCylinderSides(){const t=this.shadowRoot.querySelector(".cylinder__container");Array.from(this.shadowRoot.querySelectorAll(".cylinder__side")).forEach(e=>t.removeChild(e))}}customElements.define("cylinder-3d",P);class x extends HTMLElement{#K;constructor(t,e,s,i,r,n){super(),this.style.display="grid",this.style.gridTemplateRows=`repeat(${r}, 1fr)`,this.style.transformStyle="preserve-3d",this.style.position="absolute",this.style.placeItems="center";const o=`${i}px`;this.style.gap=o,this.style.width=`${t}px`,this.style.height=`${e}px`,this.#K=[];const a=(e-i*r)/r,l="0.6";for(let e=0;e<r;e++){const i=[t,a,s,n,"1px solid black",!0];let o;o=0===e?new P(...i,l):e===r-1?new P(...i,!1,l):new P(...i,!1,!1,l),this.#K.push(o),this.appendChild(o)}}}customElements.define("hinge-3d",x);class T extends HTMLElement{constructor(t,e,s,i,r){super(),this.style.display="grid",this.style.placeItems="center",this.style.transformOrigin=`center ${12*-t}px`,this.style.transformStyle="preserve-3d",this.style.transition="transform 0.6s ease-out 0.3s, opacity 0.6s ease-out 0.3s, z-index 0.6s ease-out 0.3s",this.style.position="absolute",this.style.placeSelf="center";const n=3*t,o=new x(2*t,n,6,5,3,s),a=new x(2*t,n,6,5,3,s),l=new A(t,e,s,i,10,r),h=new m(t,e,s,i,r);this.shipBoard=l,this.hitBoard=h,this.leftHinge=o,this.rightHinge=a,this.blockSize=t,this.append(l,h,o,a),l.style.transform="rotateZ(10deg)"}connectedCallback(){const t=this.offsetParent.offsetWidth,e=this.offsetParent.offsetHeight;this.hitBoard.style.transform=`translateZ(${t/-2+this.blockSize/2}px) translateY(${e/2-8*this.blockSize}px)`,this.shipBoard.style.transform=`rotateX(90deg) translateZ(${e/-2+this.blockSize/2}px) translateY(${t/-2+8.15*this.blockSize}px)`,this.leftHinge.style.transform=`rotateX(90deg) rotateZ(90deg) translateZ(${e/-2+this.blockSize}px) translateX(${t/-2+this.blockSize}px) translateY(${3.5*this.blockSize}px)`,this.rightHinge.style.transform=`rotateX(90deg) rotateZ(90deg) translateZ(${e/-2+this.blockSize}px) translateX(${t/-2+this.blockSize}px) translateY(${-3.5*this.blockSize}px)`}rotate3D(t,e,s){this.style.transform=`rotateX(${t}deg) rotateY(${e}deg) rotateZ(${s}deg)`}rotateForShipPlacement(){this.rotate3D(-60,0,0)}rotateForHitBoard(){this.rotate3D(-20,0,0)}rotateForHitBoardNeg180(){this.rotate3D(-20,-180,0)}rotateForHitBoard180(){this.rotate3D(-20,180,0)}rotateOutShipPlacement(){this.rotate3D(-60,180,0),this.zIndex="-1"}rotateInShipPlacement(){this.rotate3D(-60,360,0),this.zIndex="-1"}ships(){return this.shipBoard.ships()}hideShips(){this.ships().forEach(t=>{t.classList.add("dnone")})}showShips(){this.ships().forEach(t=>{t.classList.remove("dnone")})}blinkOut(){this.style.zIndex="-1",this.style.transform="scale(0) rotateY(-180deg)"}blinkIn(){this.style.zIndex="1",this.style.transform="scale(1) rotateY(0deg)"}init(){this.shipBoard.init()}teardown(){this.shipBoard.teardown()}flipZIndex(){this.style.zIndex*=-1}getHitCell(t,e){return Array.from(this.hitBoard.querySelectorAll(".hit-cell"))[10*e+t]}getShipCell(t,e){return Array.from(this.shipBoard.querySelectorAll(".ship-cell"))[10*e+t]}}customElements.define("game-board",T);class L extends HTMLElement{#T;#L;constructor(t,e,s,i){super(),this.id="game";const r=t||Number(this.getAttribute("block-size"));if(!r)throw new Error("requires block-size attribute with a number");const n=e||Number(this.getAttribute("hole-size"));if(!n)throw new Error("requires hit-size attribute with a number");this.#L=n,this.#T=r,this.style.transformStyle="preserve-3d",this.style.position="relative",this.style.transform=`translateY(${3*r}px)`;const o=s||this.getAttribute("color-primary")||window.getComputedStyle(this).getPropertyValue("--color-primary"),a=i||this.getAttribute("color-secondary")||window.getComputedStyle(this).getPropertyValue("--color-secondary");this.colorPrimary=o,this.colorSecondary=a;const l=new T(r,n,o,a,0),h=new T(r,n,o,a,1);l.style.zIndex=1,h.style.zIndex=-1,l.id="player0-board",h.id="player1-board",this.append(l,h)}getBlockSize(){return this.#T}getHoleSize(){return this.#L}getColors(){return[this.colorPrimary,this.colorSecondary]}rotate3D(t,e,s){this.style.transform=`rotateX(${t}deg) rotateY(${e}deg) rotateZ(${s}deg)`}}customElements.define("game-el",L);class k extends HTMLElement{constructor(t,e,s,i=!0){super(),this.style.transformStyle="preserve-3d",this.style.display="grid",this.style.placeItems="center";const r=p(1.5*e,t,s,s,"1px solid black");if(r.classList.add("peg-top"),r.style.position="absolute",r.style.transform=`translateZ(${t/2+1}px)`,this.appendChild(r),i){const i=p(e,t/2,s,s,"1px solid black");i.classList.add("peg-bottom"),i.style.position="absolute",i.style.transform=`translateZ(${-t/4-1}px)`,this.appendChild(i)}}}class _ extends k{constructor(t,e,s=!0){super(t,e,"white",s)}}customElements.define("miss-peg",_);class R extends k{constructor(t,e,s=!0){super(t,e,"red",s)}}customElements.define("hit-peg",R);class B{#y;#S;#L;#T;#N;#V;#U;#X;#F;#W;#j;#Q;constructor(){this.welcomeScreen=document.querySelector("#welcome-screen"),this.player0board=document.getElementById("player0-board"),this.player1board=document.getElementById("player1-board"),this.#N=document.getElementById("toast-container"),this.#V=document.getElementById("play-controls"),this.#U=document.getElementById("setup-controls"),this.#X=document.getElementById("volume-controls"),this.#F=document.getElementById("volume-on-btn"),this.#W=document.getElementById("volume-off-btn"),this.#j=!0,this.#S=[this.player0board,this.player1board],this.game=document.getElementById("game"),this.#L=this.game.getHoleSize(),this.#T=this.game.getBlockSize(),this.main=document.querySelector("#main"),this.playerModeBtns=Array.from(document.querySelectorAll(".welcome-player-mode")),this.player1board.rotateOutShipPlacement(),this.player1board.classList.add("hidden"),this.welcomeScreen.classList.remove("hidden"),this.main.classList.add("hidden")}bindPlayerModeButtons(){for(let t=0;t<this.playerModeBtns.length;t++)this.playerModeBtns[t].addEventListener("click",()=>{s.emit(e.SELECT_GAME_TYPE,t)})}hideWelcomeScreen(){this.welcomeScreen.classList.add("hidden"),this.main.classList.remove("hidden"),this.#y===o.PLAYER&&this.player1board.classList.remove("hidden")}bindStartGameButton(){document.getElementById("player0-ready-btn").addEventListener("click",t=>{t.target.classList.add("dnone"),this.player0board.teardown(),s.emit(e.PLAYER0_READY),this.#y===o.PLAYER&&document.getElementById("player1-ready-btn").classList.remove("dnone")}),document.getElementById("player1-ready-btn").addEventListener("click",t=>{t.target.disabled=!0,this.player1board.teardown(),s.emit(e.PLAYER1_READY)})}initPlayer0(){this.player0board.init()}initPlayer1(){this.#y===o.PLAYER&&(this.player0board.hideShips(),this.player0board.rotateOutShipPlacement(),this.player1board.init(),this.player1board.rotateInShipPlacement())}start2PlayerGame(){this.#y===o.PLAYER&&this.player1board.hideShips()}setGameType(t){this.#y=t}rotateForHitBoards(){this.player0board.rotateForHitBoard(),this.player1board.rotateForHitBoard180()}phaseChange(){this.GameType===o.COMPUTER?this.player0board.rotate3D(-20,0,0):(this.announcePassDevice(n.PLAYER_0),this.updateCurrentPlayer(n.PLAYER_0),this.player0board.rotateForShipPlacement(),this.player1board.rotateOutShipPlacement(),setTimeout(this.rotateForHitBoards.bind(this),900))}rotateForShipPlacement(){this.player0board.rotate3D(-60,0,0)}addPegToAttackingPlayerHitBoard(t,e,s,i){const r=this.#S[s].getHitCell(t,e);let n;if("hit"===i)n=new R(this.#T,this.#L);else{if("miss"!==i)throw new Error("got event that was not hit or miss:",i);n=new _(this.#T,this.#L)}n.animate([{transform:"translateZ(999px)"},{transform:"translateZ(0)"}],200),r.appendChild(n)}addPegToReceivedPlayerShipBoard(t,e,s,i){const r=this.#S[s],n=r.getShipCell(t,e);let o;if("hit"===i)o=new R(this.#T,this.#L,!1),o.style.transform=`translateZ(${this.#T/2}px)`,o.animate([{transform:"translateZ(999px)"},{transform:`translateZ(${this.#T/2}px)`}],200);else{if("miss"!==i)throw new Error("got event that was not hit or miss:",i);o=new _(this.#T,this.#L,!1),o.style.transform=`translateZ(${-r.shipBoard.getOffsetDepth()/2}px)`,o.animate([{transform:"translateZ(999px)"},{transform:`translateZ(${-r.shipBoard.getOffsetDepth()/2}px)`}],200)}n.appendChild(o)}handleReceivedAttackMiss(t,e,s){this.addPegToAttackingPlayerHitBoard(t,e,1^s,"miss"),this.addPegToReceivedPlayerShipBoard(t,e,s,"miss")}handleReceivedAttackHit(t,e,s,i){this.addPegToAttackingPlayerHitBoard(t,e,1^i,"hit"),this.addPegToReceivedPlayerShipBoard(t,e,i,"hit")}bindPlayer0HitBoardEvents(){this.player0board.querySelector(".hit-board").bindEvents()}bindPlayer1HitBoardEvents(){this.player1board.querySelector(".hit-board").bindEvents()}unbindPlayer0HitBoardEvents(){this.player0board.querySelector(".hit-board").unbindEvents()}unbindPlayer1HitBoardEvents(){this.player1board.querySelector(".hit-board").unbindEvents()}bindHitBoardEvents(){this.bindPlayer0HitBoardEvents(),this.#y===o.PLAYER&&this.bindPlayer1HitBoardEvents()}playerString(t){return this.#y===o.COMPUTER?t===n.COMPUTER?"The computer":"The player":`Player ${t+1}`}announcePassDevice(t){this.#y===o.PLAYER&&this.#N.addToast(`Pass device back to ${this.playerString(t)}`,5e3)}announceMiss(t,e,s){this.#N.addToast(`${this.playerString(1^s)} missed...`,600)}announceHit(t,e,s,i){this.#N.addToast(`${this.playerString(1^i)} hit a ${s}`,1500)}announceSunkShip(t,e,s,i){this.#N.addToast(`${this.playerString(i)}'s ${s} was sunk!`,2e3)}announceGameOver(t,e,s,i){const r=document.getElementById("winner-dialog");r.querySelector("#winner-span").innerText=`${this.playerString(1^i)}`,r.showModal()}initButtons(){this.#U.classList.add("dnone"),this.#V.classList.add("dnone")}showSetupButtons(){const t=this.#U.querySelector("#player0-ready-btn");t.innerText=this.#y===o.COMPUTER?"Ready":"Player 1 Ready",t.classList.remove("dnone"),this.#U.classList.remove("dnone")}hideSetupButtons(){this.#U.classList.add("dnone")}updatePlayerButtonName(t){this.#V.querySelector("#current-player-label").innerText=`${this.playerString(t)}'s Turn:`}handlePlayerEndTurnClick(){this.#Q===n.PLAYER_1?(this.player1board.hideShips(),this.announcePassDevice(n.PLAYER_1),this.player0board.rotateForHitBoardNeg180(),this.player1board.rotateForHitBoard()):(this.player0board.hideShips(),this.announcePassDevice(n.PLAYER_0),this.player0board.rotateForHitBoard(),this.player1board.rotateForHitBoard180()),this.updatePlayerButtonName(this.#Q)}handleShowShipsMouseDown(){this.#Q===n.PLAYER_0?this.player0board.showShips():this.player1board.showShips()}handleShowShipsMouseUp(){this.#Q===n.PLAYER_0?this.player0board.hideShips():this.player1board.hideShips()}disableShowShipsBtn(){this.#V.querySelector("#show-ships-btn").disabled=!0}bindPlayControlsButtons(){const t=this.#V.querySelector("#end-turn-btn"),e=this.#V.querySelector("#show-ships-btn");e.addEventListener("mousedown",()=>{this.handleShowShipsMouseDown()}),e.addEventListener("mouseup",()=>{this.handleShowShipsMouseUp()}),e.addEventListener("mouseleave",()=>{this.handleShowShipsMouseUp()}),t.addEventListener("click",()=>{t.disabled=!0,this.handlePlayerEndTurnClick(),e.disabled=!1})}disableEndTurnBtn(){this.#V.querySelector("#end-turn-btn").disabled=!0}enableEndTurnBtn(){this.#V.querySelector("#end-turn-btn").disabled=!1}showPlayerButtons(){this.#y===o.PLAYER&&(this.disableEndTurnBtn(),this.updatePlayerButtonName(n.PLAYER_0),this.#V.classList.remove("dnone"))}showVolumeControls(){this.#X.classList.remove("dnone")}hideVolumeControls(){this.#X.classList.add("dnone")}bindPlayAgainButton(){document.getElementById("play-again-btn").addEventListener("click",()=>{document.getElementById("winner-dialog").close();const[t,i]=this.game.getColors();this.game.replaceWith(new L(this.#T,this.#L,t,i)),s.emit(e.RESTART_GAME)})}playSplashAudio(){this.#j&&new Audio("../assets/water-splash-199583.mp3").play()}playHitAudio(){this.#j&&new Audio("../assets/missile-explosion.mp3").play()}toggleVolume(){this.#j=!this.#j,this.#j?(this.#F.classList.remove("dnone"),this.#W.classList.add("dnone")):(this.#F.classList.add("dnone"),this.#W.classList.remove("dnone"))}bindVolumeButtons(){this.#X.addEventListener("click",()=>{this.toggleVolume()})}updateCurrentPlayer(t){this.#Q=t}hideControls(){this.#U.classList.add("dnone"),this.#U.querySelector("#player0-ready-btn").classList.add("dnone"),this.#U.querySelector("#player1-ready-btn").classList.add("dnone"),this.#V.classList.add("dnone")}bindEvents(){this.bindVolumeButtons(),this.bindPlayerModeButtons(),this.bindStartGameButton(),this.bindPlayAgainButton(),this.bindPlayControlsButtons(),s.on(e.GAME_START,this.setGameType.bind(this)),s.on(e.GAME_START,this.hideWelcomeScreen.bind(this)),s.on(e.GAME_START,this.rotateForShipPlacement.bind(this)),s.on(e.GAME_START,this.initPlayer0.bind(this)),s.on(e.GAME_START,this.showSetupButtons.bind(this)),s.on(e.PLAYER0_READY,this.initPlayer1.bind(this)),s.on(e.PLAYER1_READY,this.start2PlayerGame.bind(this)),s.on(e.PHASE_CHANGE,this.phaseChange.bind(this)),s.on(e.PHASE_CHANGE,this.bindHitBoardEvents.bind(this)),s.on(e.PHASE_CHANGE,this.hideSetupButtons.bind(this)),s.on(e.PHASE_CHANGE,this.showPlayerButtons.bind(this)),s.on(e.RECEIVED_ATTACK,this.updateCurrentPlayer.bind(this)),s.on(e.RECEIVED_ATTACK,this.enableEndTurnBtn.bind(this)),s.on(e.RECEIVED_ATTACK,this.disableShowShipsBtn.bind(this)),s.on(e.RECEIVED_ATTACK_MISS,this.handleReceivedAttackMiss.bind(this)),s.on(e.RECEIVED_ATTACK_HIT,this.handleReceivedAttackHit.bind(this)),s.on(e.SHIP_SUNK,this.handleReceivedAttackHit.bind(this)),s.on(e.GAME_OVER,this.handleReceivedAttackHit.bind(this)),s.on(e.GAME_START,this.showVolumeControls.bind(this)),s.on(e.RECEIVED_ATTACK_MISS,this.playSplashAudio.bind(this)),s.on(e.RECEIVED_ATTACK_HIT,this.playHitAudio.bind(this)),s.on(e.GAME_OVER,this.hideControls.bind(this)),s.on(e.RECEIVED_ATTACK_MISS,this.announceMiss.bind(this)),s.on(e.RECEIVED_ATTACK_HIT,this.announceHit.bind(this)),s.on(e.SHIP_SUNK,this.announceSunkShip.bind(this)),s.on(e.GAME_OVER,this.announceGameOver.bind(this))}}let $,H;function I(){s.offAll(),$=new h,H=new B,$.bindEvents(),H.bindEvents(),s.on(e.RESTART_GAME,I)}document.addEventListener("DOMContentLoaded",()=>{I()})})();